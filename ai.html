<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²ã‚ï¼ AI ãƒšãƒ³ã‚®ãƒ³</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f4f8;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            color: #333;
            text-align: center;
            overflow: hidden; /* Prevent body scroll */
        }

        .container {
            background-color: #ffffff;
            padding: 40px 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 500px;
            box-sizing: border-box;
            border: 4px solid #b3d9ff;
        }

        h1 {
            font-size: 2.2rem;
            color: #0066cc;
            margin-bottom: 10px;
            font-weight: 700;
        }

        p {
            font-size: 1rem;
            color: #666;
            margin-top: 0;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            background-color: #ff8c42;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 5px #e07b3b;
            user-select: none;
        }

        .btn:hover {
            background-color: #ff7826;
        }

        .btn:active {
            box-shadow: 0 2px #e07b3b;
            transform: translateY(3px);
        }

        .btn-start {
            background-color: #4CAF50;
            box-shadow: 0 5px #388e3c;
            padding: 15px 40px;
        }

        .btn-start:hover {
            background-color: #45a049;
        }

        .btn-start:active {
            box-shadow: 0 2px #388e3c;
            transform: translateY(3px);
        }
        
        .btn-left {
            background-color: #8A2BE2;
            box-shadow: 0 5px #6A1EB4;
        }
        
        .btn-left:hover {
            background-color: #7A2BD4;
        }
        
        .btn-left:active {
            box-shadow: 0 2px #6A1EB4;
        }

        .btn-right {
            background-color: #00BFFF;
            box-shadow: 0 5px #009ACD;
        }

        .btn-right:hover {
            background-color: #00AFFF;
        }

        .btn-right:active {
            box-shadow: 0 2px #009ACD;
        }

        #gameCanvas {
            width: 100%;
            height: 200px;
            background-color: #e6f3ff;
            border-radius: 15px;
            margin-top: 20px;
            border: 2px solid #b3d9ff;
        }
        
        .score-display {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
        }
        
        .score-item {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            display: none;
            z-index: 1000;
        }
        
        .message-box h3 {
            margin: 0;
            font-size: 2rem;
        }

        .message-box p {
            margin: 10px 0 0;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>é€²ã‚ï¼ AI ãƒšãƒ³ã‚®ãƒ³</h1>
        <p>
            ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã® **'Shift'** ã‚­ãƒ¼ã‚’æŠ¼ã™ã‹ã€**ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€**ãƒœã‚¿ãƒ³ã§é–‹å§‹ï¼<br>
            **ã€Œä¸Šã€** ã¨ **ã€Œä¸‹ã€** ãƒœã‚¿ãƒ³ã§éšœå®³ç‰©ã‚’ã‚ˆã‘ã‚ˆã†ï¼
        </p>

        <div class="score-display">
            <div class="score-item">
                ã‚¹ã‚³ã‚¢: <span id="scoreDisplay">0</span>
            </div>
            <div class="score-item">
                ãƒ©ã‚¤ãƒ•: <span id="lifeDisplay">3</span> â¤ï¸
            </div>
            <div class="score-item">
                ã‚¿ã‚¤ãƒ : <span id="timerDisplay">30.00</span> ç§’
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div class="controls">
            <button class="btn btn-left" id="btnUp">ä¸Š</button>
            <button class="btn btn-right" id="btnDown">ä¸‹</button>
        </div>
        <div class="controls" style="margin-top: 15px;">
             <button class="btn btn-start" id="btnStart">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>

    </div>

    <div class="message-box" id="messageBox">
        <h3 id="messageTitle"></h3>
        <p id="messageText"></p>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ã®åŸºæœ¬è¨­å®š
        const GAME_DURATION = 30; // ã‚²ãƒ¼ãƒ æ™‚é–“ (ç§’)
        const INITIAL_GAME_SPEED = 3; // ã‚²ãƒ¼ãƒ ã®åˆæœŸé€Ÿåº¦
        const SPEED_INCREASE_RATE = 0.5; // ã‚¹ãƒ”ãƒ¼ãƒ‰ã®å¢—åŠ é‡
        const SPEED_INCREASE_INTERVAL = 5; // ä½•ç‚¹ã”ã¨ã«ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¸Šã’ã‚‹ã‹
        const LANE_HEIGHT = 40; // ãƒ¬ãƒ¼ãƒ³ã®é«˜ã•
        const PENGUIN_SIZE = 50;
        const MAX_LIVES = 3;
        const INVINCIBILITY_DURATION = 5000; // ç„¡æ•µæ™‚é–“ (ãƒŸãƒªç§’)

        // HTMLè¦ç´ ã®å–å¾—
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timerDisplay = document.getElementById('timerDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const lifeDisplay = document.getElementById('lifeDisplay');
        const btnUp = document.getElementById('btnUp');
        const btnDown = document.getElementById('btnDown');
        const btnStart = document.getElementById('btnStart');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');

        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹å¤‰æ•°
        let isGameActive = false;
        let score = 0;
        let lives = MAX_LIVES;
        let startTime = 0;
        let animationFrameId = null;
        let currentGameSpeed = INITIAL_GAME_SPEED;
        let lastSpeedIncreaseScore = 0;
        let isInvincible = false;
        let invincibilityStartTime = 0;

        // ãƒšãƒ³ã‚®ãƒ³ã®ä½ç½®æƒ…å ±
        const lanes = [canvas.height / 2 - LANE_HEIGHT, canvas.height / 2 + LANE_HEIGHT];
        let currentLaneIndex = 0;
        let penguinY = lanes[currentLaneIndex];
        const penguinX = 50;

        // ã‚¢ã‚¤ãƒ†ãƒ ã®é…åˆ—
        let obstacles = [];
        let scoreItems = [];
        let invincibilityPotions = [];
        let heartItems = [];
        let isColliding = false;

        // ãƒšãƒ³ã‚®ãƒ³ã‚’æç”»
        function drawPenguin() {
            ctx.font = PENGUIN_SIZE + 'px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const penguinEmoji = isInvincible ? 'ğŸ¥·' : 'ğŸ§';
            ctx.fillText(penguinEmoji, penguinX, penguinY);
        }

        // éšœå®³ç‰©ã‚’æç”»
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.font = '40px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ğŸ§Š', obstacle.x, obstacle.y);
            });
        }
        
        // ã‚¹ã‚³ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’æç”»
        function drawScoreItems() {
            scoreItems.forEach(item => {
                ctx.font = '30px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('â­', item.x, item.y);
            });
        }

        // ç„¡æ•µãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»
        function drawInvincibilityPotions() {
            invincibilityPotions.forEach(potion => {
                ctx.font = '30px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ğŸ§ª', potion.x, potion.y);
            });
        }

        // ãƒãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’æç”»
        function drawHeartItems() {
            heartItems.forEach(heart => {
                ctx.font = '30px serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('â¤ï¸', heart.x, heart.y);
            });
        }

        // éšœå®³ç‰©ã‚’ç”Ÿæˆ
        function generateObstacle() {
            const lane = Math.floor(Math.random() * lanes.length);
            obstacles.push({
                x: canvas.width,
                y: lanes[lane],
                width: 40,
                height: 40,
                passed: false
            });
        }
        
        // ã‚¹ã‚³ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆ
        function generateScoreItem() {
            const lane = Math.floor(Math.random() * lanes.length);
            scoreItems.push({
                x: canvas.width,
                y: lanes[lane],
                width: 30,
                height: 30,
                collected: false
            });
        }

        // ç„¡æ•µãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
        function generateInvincibilityPotion() {
            const lane = Math.floor(Math.random() * lanes.length);
            invincibilityPotions.push({
                x: canvas.width,
                y: lanes[lane],
                width: 30,
                height: 30,
                collected: false
            });
        }

        // ãƒãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”Ÿæˆ
        function generateHeartItem() {
            const lane = Math.floor(Math.random() * lanes.length);
            heartItems.push({
                x: canvas.width,
                y: lanes[lane],
                width: 30,
                height: 30,
                collected: false
            });
        }
        
        // æç”»ã‚’æ›´æ–°
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            
            // åœ°é¢ã‚’æç”»
            ctx.fillStyle = '#b3d9ff';
            ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);
            
            drawPenguin();
            drawObstacles();
            drawScoreItems();
            drawInvincibilityPotions();
            drawHeartItems();
        }

        // ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°
        function update() {
            if (!isGameActive) return;

            // ç„¡æ•µæ™‚é–“ã®çµ‚äº†åˆ¤å®š
            if (isInvincible && Date.now() - invincibilityStartTime > INVINCIBILITY_DURATION) {
                isInvincible = false;
                showMessageBox('ç„¡æ•µçµ‚äº†ï¼', 'æ°—ã‚’ä»˜ã‘ã¦ã­ï¼');
            }

            // ã‚¹ãƒ”ãƒ¼ãƒ‰ã®å¢—åŠ åˆ¤å®š
            if (score > lastSpeedIncreaseScore + SPEED_INCREASE_INTERVAL) {
                currentGameSpeed += SPEED_INCREASE_RATE;
                lastSpeedIncreaseScore = score;
                showMessageBox('ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼', 'é›£æ˜“åº¦ãŒä¸ŠãŒã£ãŸã‚ˆï¼');
            }

            // ã‚¢ã‚¤ãƒ†ãƒ ã¨éšœå®³ç‰©ã®ä½ç½®ã‚’æ›´æ–°
            obstacles.forEach(obstacle => obstacle.x -= currentGameSpeed);
            scoreItems.forEach(item => item.x -= currentGameSpeed);
            invincibilityPotions.forEach(potion => potion.x -= currentGameSpeed);
            heartItems.forEach(heart => heart.x -= currentGameSpeed);

            // è¡çªåˆ¤å®šï¼ˆéšœå®³ç‰©ï¼‰
            obstacles.forEach(obstacle => {
                if (!isColliding && !isInvincible && penguinX < obstacle.x + obstacle.width &&
                    penguinX + PENGUIN_SIZE > obstacle.x &&
                    penguinY - PENGUIN_SIZE / 2 < obstacle.y &&
                    penguinY + PENGUIN_SIZE / 2 > obstacle.y) {
                    
                    lives--;
                    lifeDisplay.textContent = lives;
                    isColliding = true;
                    showMessageBox('ã—ã¾ã£ãŸï¼', 'æ°·ã«ã¶ã¤ã‹ã£ãŸï¼');
                    setTimeout(() => isColliding = false, 1000);
                    obstacles = obstacles.filter(o => o !== obstacle); // ã¶ã¤ã‹ã£ãŸéšœå®³ç‰©ã‚’å‰Šé™¤
                }
            });

            // è¡çªåˆ¤å®šï¼ˆã‚¹ã‚³ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ï¼‰
            scoreItems.forEach(item => {
                if (penguinX < item.x + item.width &&
                    penguinX + PENGUIN_SIZE > item.x &&
                    penguinY - PENGUIN_SIZE / 2 < item.y &&
                    penguinY + PENGUIN_SIZE / 2 > item.y && !item.collected) {
                    
                    score += 5;
                    scoreDisplay.textContent = score;
                    item.collected = true;
                    scoreItems = scoreItems.filter(o => o !== item); // å–å¾—ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
                }
            });

            // è¡çªåˆ¤å®šï¼ˆç„¡æ•µãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            invincibilityPotions.forEach(potion => {
                if (penguinX < potion.x + potion.width &&
                    penguinX + PENGUIN_SIZE > potion.x &&
                    penguinY - PENGUIN_SIZE / 2 < potion.y &&
                    penguinY + PENGUIN_SIZE / 2 > potion.y && !potion.collected) {
                    
                    isInvincible = true;
                    invincibilityStartTime = Date.now();
                    showMessageBox('ç„¡æ•µï¼', 'ç„¡æ•µãƒšãƒ³ã‚®ãƒ³ã«å¤‰èº«ï¼');
                    potion.collected = true;
                    invincibilityPotions = invincibilityPotions.filter(o => o !== potion);
                }
            });
            
            // è¡çªåˆ¤å®šï¼ˆãƒãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ï¼‰
            heartItems.forEach(heart => {
                if (penguinX < heart.x + heart.width &&
                    penguinX + PENGUIN_SIZE > heart.x &&
                    penguinY - PENGUIN_SIZE / 2 < heart.y &&
                    penguinY + PENGUIN_SIZE / 2 > heart.y && !heart.collected) {
                    
                    if (lives < MAX_LIVES) {
                        lives++;
                        lifeDisplay.textContent = lives;
                        showMessageBox('ãƒ©ã‚¤ãƒ•å›å¾©ï¼', 'ãƒãƒ¼ãƒˆã‚’å–ã£ãŸã‚ˆï¼');
                    }
                    heart.collected = true;
                    heartItems = heartItems.filter(o => o !== heart);
                }
            });


            // ç”»é¢å¤–ã«å‡ºãŸã‚¢ã‚¤ãƒ†ãƒ ã¨éšœå®³ç‰©ã‚’å‰Šé™¤
            obstacles = obstacles.filter(obstacle => obstacle.x > -obstacle.width);
            scoreItems = scoreItems.filter(item => item.x > -item.width);
            invincibilityPotions = invincibilityPotions.filter(potion => potion.x > -potion.width);
            heartItems = heartItems.filter(heart => heart.x > -heart.width);

            // éšœå®³ç‰©ã€ã‚¹ã‚³ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã€ç„¡æ•µãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒãƒ¼ãƒˆã‚’ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç”Ÿæˆ
            if (Math.random() < 0.02 * (currentGameSpeed / INITIAL_GAME_SPEED)) {
                generateObstacle();
            }
            if (Math.random() < 0.005) {
                generateScoreItem();
            }
            if (Math.random() < 0.001) {
                generateInvincibilityPotion();
            }
            if (Math.random() < 0.001) {
                generateHeartItem();
            }

            // ã‚¿ã‚¤ãƒãƒ¼ã‚’æ›´æ–°
            const elapsedTime = (Date.now() - startTime) / 1000;
            const remainingTime = Math.max(0, GAME_DURATION - elapsedTime);
            timerDisplay.textContent = remainingTime.toFixed(2);

            if (remainingTime <= 0 || lives <= 0) {
                isGameActive = false;
                showMessageBox('ã‚²ãƒ¼ãƒ çµ‚äº†ï¼', `æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}`);
                btnStart.disabled = false;
                btnUp.disabled = true;
                btnDown.disabled = true;
                cancelAnimationFrame(animationFrameId);
                return;
            }

            draw(); // å†æç”»
            animationFrameId = requestAnimationFrame(update);
        }

        // ãƒšãƒ³ã‚®ãƒ³ã®ä½ç½®ã‚’ä¸Šä¸‹ã«å‹•ã‹ã™
        function movePenguin(direction) {
            if (!isGameActive || isColliding) return;

            if (direction === 'up' && currentLaneIndex > 0) {
                currentLaneIndex--;
            } else if (direction === 'down' && currentLaneIndex < lanes.length - 1) {
                currentLaneIndex++;
            }
            penguinY = lanes[currentLaneIndex];
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
        document.addEventListener('keydown', (e) => {
            // Shiftã‚­ãƒ¼ã§ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
            if (e.key === 'Shift') {
                startGame();
            }
            
            // Aã‚­ãƒ¼ã¨Bã‚­ãƒ¼ã§å…¥åŠ›
            if (e.key === 'a' || e.key === 'A') {
                movePenguin('up');
                btnUp.classList.add('btn-active');
            } else if (e.key === 'b' || e.key === 'B') {
                movePenguin('down');
                btnDown.classList.add('btn-active');
            }
        });
        
        document.addEventListener('keyup', (e) => {
            if (e.key === 'a' || e.key === 'A') {
                btnUp.classList.remove('btn-active');
            } else if (e.key === 'b' || e.key === 'B') {
                btnDown.classList.remove('btn-active');
            }
        });

        // ãƒœã‚¿ãƒ³å…¥åŠ›
        btnUp.addEventListener('click', () => movePenguin('up'));
        btnDown.addEventListener('click', () => movePenguin('down'));
        btnStart.addEventListener('click', startGame);

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º
        function showMessageBox(title, text) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        // ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¦é–‹å§‹
        function startGame() {
            if (isGameActive) return;

            // ã‚²ãƒ¼ãƒ é–‹å§‹ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            btnStart.disabled = true;
            btnUp.disabled = true;
            btnDown.disabled = true;

            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
            showMessageBox('æº–å‚™ã¯ã„ã„ï¼Ÿ', '3');
            setTimeout(() => {
                showMessageBox('æº–å‚™ã¯ã„ã„ï¼Ÿ', '2');
            }, 1000);
            setTimeout(() => {
                showMessageBox('æº–å‚™ã¯ã„ã„ï¼Ÿ', '1');
            }, 2000);
            setTimeout(() => {
                // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å¾Œã«ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
                showMessageBox('ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼', 'é ‘å¼µã£ã¦ã­ï¼');
                isGameActive = true;
                score = 0;
                lives = MAX_LIVES;
                scoreItems = [];
                isColliding = false;
                invincibilityPotions = [];
                heartItems = [];
                isInvincible = false;
                invincibilityStartTime = 0;
                startTime = Date.now();
                currentLaneIndex = 0;
                penguinY = lanes[currentLaneIndex];
                obstacles = [];
                currentGameSpeed = INITIAL_GAME_SPEED; // ã‚²ãƒ¼ãƒ ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’åˆæœŸå€¤ã«æˆ»ã™
                lastSpeedIncreaseScore = 0;
                
                // ã‚²ãƒ¼ãƒ é–‹å§‹å¾Œã«ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                btnUp.disabled = false;
                btnDown.disabled = false;
                
                // åˆæœŸæç”»
                draw();
                
                // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹
                animationFrameId = requestAnimationFrame(update);
            }, 3000);
        }
        
        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
        window.onload = function() {
            draw(); // åˆæœŸæç”»
            showMessageBox('ã‚²ãƒ¼ãƒ èª¬æ˜', 'ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã‹ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã€ŒShiftã€ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚ˆã†ï¼');
            btnUp.disabled = true;
            btnDown.disabled = true;
        };
    </script>
</body>
</html>
